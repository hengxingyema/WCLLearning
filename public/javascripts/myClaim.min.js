var app=angular.module("yemaWebApp",[]),navIndex=3;app.controller("myClaimControl",function($scope,$http,$location){$scope.noApp=!1,$scope.isLoadingMyApp=!0;var appurlList=$location.absUrl().split("/"),userId=appurlList[appurlList.length-1],todayUrl="/myClaim/claim/"+userId,claimParams=Object(),uploadName=void 0;uploadName=window.localStorage?localStorage.getItem("uploadName"):getCookie("uploadName"),void 0!=uploadName&&(claimParams.uploadName=uploadName),$http.post(todayUrl,claimParams).success(function(response){$scope.isLoadingMyApp=!1,$scope.dailyTask=response.myClaimApps,$scope.rejectedTaskObjects=response.rejectedTaskObjects;for(var i=0;i<response.myClaimApps.length;i++)response.myClaimApps[i].mode=!0,console.log(response.myClaimApps[i]),console.log(response.myClaimApps[i].rejected);$scope.dailyTask.length>0?$scope.noApp=!1:$scope.noApp=!0}),$scope.copy=$location.absUrl(),$scope.reAssign=function(app){app.mode=!1,console.log("changed")},$scope.uploadTaskVideo=function(){$("#uploadTaskVideo").modal("hide");var myVideo=document.getElementById("uploadTask");myVideo.pause()},$scope.saveRemark=function(detailRem,taskObjectId,app){var saveurl="/myClaim/saveRemark/"+userId;$http.post(saveurl,{remark:detailRem,taskObjectId:taskObjectId}).success(function(response){app.mode=!0})},$scope.keySaveAssign=function(e,detailRem,taskObjectId,app){var keycode=window.event?e.keyCode:e.which;13==keycode&&$scope.saveRemark(detailRem,taskObjectId,app)},$scope.addFavorite2=function(){var url=window.location,title=document.title,ua=navigator.userAgent.toLowerCase();if(ua.indexOf("360se")>-1)alert("由于360浏览器功能限制，请按 Ctrl+D 手动收藏！");else if(ua.indexOf("msie 8")>-1)window.external.AddToFavoritesBar(url,title);else if(document.all)try{window.external.addFavorite(url,title)}catch(e){alert("您的浏览器不支持,请按 Ctrl+D 手动收藏!")}else window.sidebar?window.sidebar.addPanel(title,url,""):alert("您的浏览器不支持,请按 Ctrl+D 手动收藏!")},$scope.url=$location.absUrl(),$scope.copyUrl=function(){$("#btn").popover("toggle");var Url=document.getElementById("copy");Url.select(),document.execCommand("Copy")},$scope.openNewPage=function(courseid){location.href="/newtaskMobile/"+courseid},$scope.turnoffTask=function(){var turnUrl="/myClaim/closeTask/"+userId;$http.post(turnUrl).success(function(response){function refresh(){location.href="/myClaim/"+userId}$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,0!=response.errorId?($scope.errorMsg=response.errorMsg,$("#popover").modal("show")):setTimeout(refresh,1e3)})},$scope.userRevoke=function(taskId){$scope.revoke=function(){var revokeURL="/myClaim/revoke";$http.post(revokeURL,{taskObjectId:taskId}).success(function(response){if($(".ui.modal").modal("hide"),$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,response.errorId<0?toastr.error(response.errorMsg):toastr.success("撤销任务成功",{timeOut:2e3}),0==response.doTaskCount)for(var i=0;i<$scope.dailyTask.length;i++){var taskObjId=$scope.dailyTask[i].taskObjectId;taskObjId==taskId&&($scope.dailyTask=$scope.dailyTask.delArray(i))}})}},Array.prototype.delArray=function(n){return n<0?this:this.slice(0,n).concat(this.slice(n+1,this.length))}});