var app=angular.module("yemaWebApp",[]),navIndex=4;app.filter("startFrom",function(){return function(inputArray,start){if(void 0==inputArray)return[];for(var array=[],i=start;i<inputArray.length;i++)array.push(inputArray[i]);return array}}),app.controller("taskCheckCtrl",function($scope,$http,$location){function getLeftMenuList(appleObjectId){var taskUrl="/taskCheck/releaseTaskList/"+appleObjectId;$http.get(taskUrl).success(function(response){if($scope.isLoadingMyApp=!1,0==response.errorId)if($scope.taskTimeList=response.taskTimeList,void 0!=response.taskTimeList&&response.taskTimeList.length>0){$scope.selectedDate(0);var preLoadDays=10;$scope.selectTimeTask.taskIds.length>20?(preLoadDays=3,toastr.warning("您的任务很多，加载速度慢，请耐心等待")):$scope.selectTimeTask.taskIds.length>10?preLoadDays=5:$scope.selectTimeTask.taskIds.length>5&&(preLoadDays=8),preLoadDays>=response.taskTimeList.length?preLoadDays=response.taskTimeList.length:toastr.info("默认显示最近"+preLoadDays+"天需要审核的任务哦"),preLoadTaskOverview(preLoadDays)}else $scope.noApp=!0})}function preLoadTaskOverview(preCount){for(var i=1;i<preCount;i++){var taskOverviewUrl="/taskCheck/releaseTaskOverview",forPreTimeTask=$scope.taskTimeList[i];forPreTimeTask.isLoading=!0,function(preTimeTask){$http.post(taskOverviewUrl,{taskIds:preTimeTask.taskIds}).success(function(response){if(preTimeTask.isLoading=!1,0==response.errorId){$scope.taskOverviewList=response.taskOverviewList;for(var i=0;i<$scope.taskOverviewList.length;i++)for(var netObject=$scope.taskOverviewList[i],j=0;j<preTimeTask.tasks.length;j++){var dealObject=preTimeTask.tasks[j];dealObject.taskId==netObject.taskId&&(dealObject.taskOverview=netObject,preTimeTask.totalUploaded+=dealObject.taskOverview.totalSubmited)}preTimeTask.isLoaded=!0}})}(forPreTimeTask)}}$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")});var appsUrl="/myapp/angular";$http.get(appsUrl).success(function(response){$scope.myApps=response.myApps.sort(function(a,b){return a.createdAt>=b.createdAt})}),$scope.loadTaskByApp=function(appleObjectId,selectedMenuIndex){$scope.menuIndex=selectedMenuIndex,$scope.selectedAppObjectId=appleObjectId,getLeftMenuList($scope.selectedAppObjectId)},$scope.loadTaskByApp("all",-1),$scope.isLoadingMyApp=!0,$scope.currentTaskId=void 0,$scope.noApp=!1,$scope.myObj=Object(),$scope.taskTimeList=[],$scope.selectedDate=function(index){$scope.taskIndex=index,$scope.selectTimeTask=$scope.taskTimeList[index];var taskOverviewUrl="/taskCheck/releaseTaskOverview";1!=$scope.selectTimeTask.isLoading&&1!=$scope.selectTimeTask.isLoaded&&($scope.selectTimeTask.isLoading=!0,$http.post(taskOverviewUrl,{taskIds:$scope.selectTimeTask.taskIds}).success(function(response){if($scope.selectTimeTask.isLoading=!1,0==response.errorId){$scope.taskOverviewList=response.taskOverviewList;for(var i=0;i<$scope.taskOverviewList.length;i++)for(var netObject=$scope.taskOverviewList[i],j=0;j<$scope.selectTimeTask.tasks.length;j++){var dealObject=$scope.selectTimeTask.tasks[j];dealObject.taskId==netObject.taskId&&(dealObject.taskOverview=netObject,$scope.selectTimeTask.totalUploaded+=dealObject.taskOverview.totalSubmited)}$scope.selectTimeTask.isLoaded=!0}}))};var oneTaskOffLock=0;$scope.oneTaskOff=function(taskId){if(1!=oneTaskOffLock){oneTaskOffLock=1;var oneTaskUrl="/taskCheck/turnOffOneTask";$http.post(oneTaskUrl,{taskId:taskId}).success(function(response){function refresh(){location.href="/taskCheck/"}oneTaskOffLock=0,$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,0!=response.errorId?($scope.errorMsg=response.errorMsg,$("#errorMsg").modal("show")):setTimeout(refresh,100)})}},$scope.confirmCancel=function(taskId){var url="/taskCheck/cancelTask/"+taskId;$http.get(url).success(function(response){0==response.errorId?toastr.success("撤销任务成功",{timeOut:2e3}):toastr.error(response.errorMsg)})},$scope.addApp=function(id){$("#"+id).popover("toggle")},$scope.lookCheck=function(taskObjectId){window.open("/nextTaskCheck/"+taskObjectId)}});