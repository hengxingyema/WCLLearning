var app=angular.module("yemaWebApp",[]),navIndex=1;app.controller("doTaskCtrl",function($scope,$http){function getTaskData(taskType,pageCount){var url="doTask/taskHall/"+pageCount+"/"+taskType;$http.get(url).success(function(response){console.log(response.allTask),$scope.isLoadingMyApp=!1;for(var i=0;i<response.allTask;i++)response.allTask[i].mode=!1,response.allTask[i].hasChanged=!1,response.allTask[i].hasTaken=!1;0==pageCount&&void 0!=response.myAppCount&&(myAppCountDic[taskType]=response.myAppCount),"allTask"==taskType?($scope.taskDisplayed=$scope.taskDisplayed.concat(response.allTask),$scope.disableTaskCount=response.disableTaskCount,$scope.taskDisplayed.length>0?$scope.noApp=!1:$scope.noApp=!0):"commentTask"==taskType?($scope.commentTask=$scope.commentTask.concat(response.allTask),$scope.commentTask.length>0?$scope.noApp=!1:$scope.noApp=!0):"downTask"==taskType?($scope.downTask=$scope.downTask.concat(response.allTask),$scope.downTask.length>0?$scope.noApp=!1:$scope.noApp=!0):"inactiveTask"==taskType&&($scope.inactiveTask=$scope.inactiveTask.concat(response.allTask),$scope.disableTaskCount=response.disableTaskCount,$scope.inactiveTask.length>0?$scope.noApp=!1:$scope.noApp=!0),$scope.hasMoreDic[taskType]=response.hasMore})}var bannerurl="doTask/banner";$http.get(bannerurl).success(function(response){$scope.bannerUrl=response.bannerUrl}),$("#myCarousel").carousel({interval:3e3}),$scope.inviteUrl="http://www.mustangop.com/user/register/"+getCookie("userIdCookie"),$scope.copyUrl=function(){$("#alert-btn").popover("toggle");var Url=document.getElementById("inviteUrlcopy");Url.select(),document.execCommand("Copy")},$scope.releaseTaskVideo=function(){$("#releaseTaskVideo").modal("hide");var myVideo=document.getElementById("releaseTask");myVideo.pause()},$scope.getTaskVideo=function(){$("#getTaskVideo").modal("hide");var myVideo=document.getElementById("getTask");myVideo.pause()},$scope.uploadTaskVideo=function(){$("#uploadTaskVideo").modal("hide");var myVideo=document.getElementById("uploadTask");myVideo.pause()},$scope.planeColor=!0,$scope.changePlaneColor=function(){$scope.planeColor=!$scope.planeColor},$scope.noApp=!1,$scope.isLoadingMyApp=!0,$scope.disableTaskCount=0,$scope.hasMoreDic={allTask:1,commentTask:1,downTask:1,inactiveTask:1};var myAppCountDic={allTask:0,commentTask:0,downTask:0};$scope.taskDisplayed=[],$scope.commentTask=[],$scope.downTask=[],$scope.inactiveTask=[],getTaskData("allTask",0),$scope.displayAll=function(){void 0==$scope.taskDisplayed||0==$scope.taskDisplayed.length?getTaskData("allTask",0):1==$scope.hasMoreDic.allTask?getTaskData("allTask",$scope.taskDisplayed.length-myAppCountDic.allTask):($scope.isLoadingMyApp=!1,$scope.noApp=!1)},$scope.commentTasksOnly=function(){$scope.isLoadingMyApp=!0,void 0==$scope.commentTask||0==$scope.commentTask.length?getTaskData("commentTask",0):1==$scope.hasMoreDic.commentTask?getTaskData("commentTask",$scope.commentTask.length-myAppCountDic.commentTask):($scope.isLoadingMyApp=!1,$scope.noApp=!1)},$scope.downloadTasksOnly=function(){$scope.isLoadingMyApp=!0,void 0==$scope.downTask||0==$scope.downTask.length?getTaskData("downTask",0):1==$scope.hasMoreDic.downTask?getTaskData("downTask",$scope.downTask.length-myAppCountDic.downTask):($scope.isLoadingMyApp=!1,$scope.noApp=!1)},$scope.inactiveTasksOnly=function(){$scope.isLoadingMyApp=!0,void 0==$scope.inactiveTask||0==$scope.inactiveTask.length?getTaskData("inactiveTask",0):1==$scope.hasMoreDic.inactiveTask?getTaskData("inactiveTask",$scope.inactiveTask.length-myAppCountDic.inactiveTask):($scope.isLoadingMyApp=!1,$scope.noApp=!1)},$scope.getTaskMarkStr=void 0;var getTaskLock=0;$scope.getTask=function(currentApp){var username=getCookie("username");if(""==username)currentApp.getTaskErrorId=-200,currentApp.errorMsg="请先登陆帐号后再领取任务";else if(1==currentApp.isMine)currentApp.getTaskErrorId=-200,currentApp.errorMsg="不能领取自己发布的任务哦";else if(parseInt(currentApp.receiveCount)!=currentApp.receiveCount||currentApp.receiveCount<=0)currentApp.getTaskErrorId=-200,currentApp.errorMsg="请填写正确的领取条目";else if(currentApp.receiveCount>currentApp.remainCount)currentApp.getTaskErrorId=-200,currentApp.errorMsg="此任务无法领取更多";else if(currentApp.receiveCount>1e3)currentApp.getTaskErrorId=-200,currentApp.errorMsg="每个任务最多领取1000条";else{if(1==getTaskLock)return;getTaskLock=1,currentApp.isGetingTask=!0;var url="doTask/postUsertask/"+currentApp.objectId+"/"+currentApp.rateUnitPrice+"/"+currentApp.appObjectId,postData={receiveCount:currentApp.receiveCount,detailRem:currentApp.detail,excUniqueCode:currentApp.excUniqueCode};$http.post(url,postData).success(function(response){getTaskLock=0,currentApp.getTaskErrorId=response.errorId,0==response.errorId?(toastr.success("接受任务成功,棒棒哒",{timeOut:2e3}),currentApp.hasTaken=!0,currentApp.errorMsg="",filterSameTask(currentApp,"hasTaken")):(toastr.error(response.errorMsg),currentApp.errorMsg=response.errorMsg,currentApp.isGetingTask=!1)})}},$scope.refresh=function(){location.reload()},$scope.showDiv=function(app){1!=app.myTask&&(app.mode=!0)},$scope.hideDiv=function(app){app.mode=!1},$scope.filtrateApp=function(appInfo){var needToSave={appObjectId:appInfo.appObjectId,excUniqueCode:appInfo.excUniqueCode,taskObjectId:appInfo.objectId};$scope.confirmAdd=function(app){var fiterAppUrl="doTask/fiterApp";$http.post(fiterAppUrl,needToSave).success(function(response){$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,0==response.errorId&&(app.hasChanged=!0,filterSameTask(app,"hasChanged"))})}};var filterSameTask=function(task,keyName){for(var allTasks=[$scope.taskDisplayed,$scope.commentTask,$scope.downTask],i=0;i<allTasks.length;i++)for(var taskList=allTasks[i],j=0;j<taskList.length;j++){var taskToCheck=taskList[j];taskToCheck.appleId==task.appleId&&(taskToCheck[keyName]=!0,$scope.inactiveTask.push(taskToCheck),$scope.disableTaskCount=$scope.disableTaskCount+1)}};$scope.loadXMLDoc=function(){var xmlhttp;xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLhttp"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status)for(xmlDoc=xmlhttp.responseXML,txt="",x=xmlDoc.getElementById(""),i=0;i<x.length;i++)txt=txt+x[i].child[0].node+"<br />",document.getElementById("")},xmlhttp.open("GET","/ajax/demo_get.asp",!0),xmlhttp.setRequestHeader("Content-type",""),xmlhttp.send()}});